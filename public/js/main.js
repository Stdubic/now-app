"use strict";class ApiHandler{get(a,b,c,d){return this.call("GET",a,b,c,d)}post(a,b,c,d){return this.call("POST",a,b,c,d)}put(a,b,c,d){return this.call("PUT",a,b,c,d)}patch(a,b,c,d){return this.call("PATCH",a,b,c,d)}delete(a,b,c,d){return this.call("DELETE",a,b,c,d)}call(a,b,c,d,e){const f=new Headers;return f.set("Accept","application/json"),f.set("Content-Type","application/json; charset=utf-8"),fetch(b,{method:a,headers:f,body:d?JSON.stringify(d):null}).then(a=>a.json()).then(a=>{c&&c(a,e)})}}class FormHandler{submit(a,b,c){const d=new Headers;return d.set("Accept","application/json"),fetch(a.action,{method:a.method,headers:d,body:new FormData(a)}).then(a=>a.json()).then(a=>{b&&b(a,c)})}}function updateCharts(a=".chart-area"){const b=$(a);if(!b.length)return;blockSection(a);const c={min_date:document.getElementById("chart-date-range-first").value,max_date:document.getElementById("chart-date-range-second").value,date_format:document.getElementById("chart-date-format").value},d=new ApiHandler;for(const e of b)d.post(e.dataset.api,plotLineChart,c,{area_id:e.id,title:e.dataset.title})}function resizeChart(a){a=document.getElementById(a),a.classList.toggle("col-sm-6"),a.classList.toggle("col-sm-12")}function initChartDatePicker(){return $(".chart-daterangepicker").daterangepicker({buttonClasses:"m-btn btn",applyClass:"btn-primary",cancelClass:"btn-secondary",timePicker:!0,timePicker24Hour:!0,showWeekNumbers:!0,autoUpdateInput:!0,maxDate:new Date,locale:{format:"DD/MM/YYYY HH:mm"}},function(c,a){const b=$(this).attr("element").attr("id");$("#"+b+"-first").val(c.format("YYYY-MM-DD HH:mm")),$("#"+b+"-second").val(a.format("YYYY-MM-DD HH:mm")),updateCharts()})}function plotLineChart(a,b){return unblockSection("#"+b.area_id),AmCharts.makeChart(b.area_id,{type:"serial",theme:"light",creditsPosition:"top-right",fontFamily:"Roboto",mouseWheelZoomEnabled:!0,dataDateFormat:"YYYY-MM-DD HH",valueAxes:[{id:"v1",axisAlpha:0,position:"left",ignoreAxisWidth:!0,precision:0}],balloon:{borderThickness:1,shadowAlpha:0},legend:{enabled:!0,position:"top",switchType:"v",useMarkerColorForLabels:!0,useMarkerColorForValues:!0},graphs:[{id:"g1",lineColor:"#5867dd",fillAlphas:.3,fillColorsField:"lineColor",balloon:{drop:!0,adjustBorderColor:!1,color:"#ffffff"},bullet:"round",bulletBorderAlpha:1,bulletColor:"#FFFFFF",title:b.title,bulletSize:5,hideBulletsCount:50,lineThickness:2,useLineColorForBulletBorder:!0,valueField:"value",balloonText:"<span style=\"font-size: 18px;\">[[value]]</span>"}],chartScrollbar:{graph:"g1",oppositeAxis:!1,offset:30,scrollbarHeight:80,backgroundAlpha:0,selectedBackgroundAlpha:.1,selectedBackgroundColor:"#888888",graphFillAlpha:0,graphLineAlpha:.5,selectedGraphFillAlpha:0,selectedGraphLineAlpha:1,autoGridCount:!0,color:"#AAAAAA"},chartCursor:{pan:!0,valueLineEnabled:!0,valueLineBalloonEnabled:!0,cursorAlpha:1,cursorColor:"#258cbb",limitToGraph:"g1",valueLineAlpha:.2,valueZoomable:!0},valueScrollbar:{oppositeAxis:!1,offset:50,scrollbarHeight:10},categoryField:"date",categoryAxis:{parseDates:!0,dashLength:1,minorGridEnabled:!0,minPeriod:"hh"},export:{enabled:!0},dataProvider:a})}const IMAGE_FILTER=["image/jpg","image/jpeg","image/png","image/bmp","image/gif"],VIDEO_FILTER=["video/mp4","video/webm","video/ogg"];function mainInit(){blockPage(),changePageTitle(),initDatatables(),initSelect(),initSwitch(),initDateTimeRangePickers(),initChartDatePicker(),initSummernote(),fixInputColor(),initMaxlength(),initRepeaters(),addFormHandlers("form-notify"),unblockPage(),updateCharts(),displayErrors("error-messages"),lazyLoadMedia("lazy-load")}function changePageTitle(){const a=document.getElementById("page-title");a&&(document.title+=" | "+a.textContent.trim())}function confirmAlert(){return swal({titleText:"Are you sure?",type:"warning",showCancelButton:!0,showCloseButton:!0,buttonsStyling:!1,confirmButtonText:"<span><i class=\"fa fa-check\"></i> <span>Ok</span></span>",confirmButtonClass:"btn m-btn btn-primary m-btn--icon",cancelButtonText:"<span><i class=\"fa fa-times\"></i> <span>Cancel</span></span>",cancelButtonClass:"btn m-btn btn-secondary m-btn--icon"})}function successAlert(){return swal({titleText:"Success!",type:"success",timer:3e3,showCloseButton:!0,buttonsStyling:!1,confirmButtonText:"<span><i class=\"fa fa-check\"></i> <span>Ok</span></span>",confirmButtonClass:"btn m-btn btn-success m-btn--icon"})}function initMaxlength(){return $("input[maxlength], textarea[maxlength]").maxlength({alwaysShow:!0,warningClass:"m-badge m-badge--primary m-badge--rounded m-badge--wide",limitReachedClass:"m-badge m-badge--danger m-badge--rounded m-badge--wide"})}function initRepeaters(a=".repeater"){return $(a).repeater({initEmpty:!1,isFirstItemUndeletable:!1,show:function(){$(this).slideDown(),initMaxlength()},hide:function(a){$(this).slideUp(a)}})}function initSwitch(){return $("[data-switch=true]").bootstrapSwitch()}function initSelect(){return $("select.m-bootstrap-select").selectpicker()}function initSummernote(){return $(".summernote").summernote({dialogsFade:!0,callbacks:{onChange:function(a){this.dataset.textarea&&(document.getElementById(this.dataset.textarea).value=a.trim())}}})}function fixInputColor(){return $("input[type=color]").css("height","36px")}function initDatatables(){return $("table.js-datatable").DataTable({order:[],processing:!0,colReorder:!0,pagingType:"full_numbers",pageLength:50,lengthMenu:[[10,50,100,-1],[10,50,100,"All"]],dom:"<'row'<'col-sm-4 text-left'f><'col-sm-4 text-left dataTables_pager'lp><'col-sm-4 text-right'B>>\n\t\t\t<'row'<'col-sm-12'tr>>\n\t\t\t<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7 dataTables_pager'lp>>",buttons:[{extend:"collection",text:"Export",autoClose:!0,buttons:["copyHtml5","print","csvHtml5","excelHtml5",{extend:"pdfHtml5",orientation:"landscape"},{text:"JSON",action:function(a,b){$.fn.dataTable.fileSave(new Blob([JSON.stringify(b.buttons.exportData())],{type:"application/json"}),document.title+".json")}}]},{extend:"collection",text:"Visibility",buttons:["colvisRestore","colvis"]}]})}function showMedia(a,b){b=document.getElementById(b),b.innerHTML="";var c,d,e,f,g;for(const h of a.files){if(c=window.URL.createObjectURL(h),e=h.type,-1<IMAGE_FILTER.indexOf(e))g="<a target=\"_blank\" href=\""+c+"\"><img class=\"img-thumbnail\" src=\""+c+"\"></a>";else if(-1<VIDEO_FILTER.indexOf(e))g="<video controls class=\"img-thumbnail\"><source src=\""+c+"\" type=\""+e+"\"></video>";else continue;d=h.name.trim(),f=h.size/1048576,f=parseFloat(f.toFixed(2)),b.insertAdjacentHTML("beforeend","<div class=\"col-sm-2\">"+g+"<p>"+d+" ("+f+" MB)</p></div>")}}function lazyLoadMedia(a){const b=$("."+a+"[data-src]");for(const c of b)c.src=c.dataset.src.trim()}function addFormHandlers(a){const b=document.querySelectorAll("form."+a);for(const c of b)c.onreset=()=>{const a=c.querySelectorAll(".gallery-container");for(const b of a)b.innerHTML=""},c.onsubmit=()=>{fireNotification({message:"Saving data in progress...",icon:"fa fa-spinner fa-spin",type:"success",delay:0});const a=document.querySelectorAll("button[type=\"submit\"][form=\""+c.id+"\"]");for(const b of a)b.disabled=!0,b.classList.add("m-loader","m-loader--light","m-loader--right")}}function blockPage(){return mApp.blockPage({overlayColor:"#000000",type:"loader",state:"success",message:"Please wait..."})}function unblockPage(){return mApp.unblockPage()}function blockSection(a){return mApp.block(a,{overlayColor:"#000000",type:"loader",state:"primary"})}function unblockSection(a){return mApp.unblock(a)}function blockModal(a){return blockSection("#"+a+" .modal-content")}function unblockModal(a){return unblockSection("#"+a+" .modal-content")}function initDateTimeRangePickers(){return $(".datetimerangepicker").daterangepicker({buttonClasses:"m-btn btn",applyClass:"btn-primary",cancelClass:"btn-secondary",timePicker:!0,timePicker24Hour:!0,showWeekNumbers:!0,autoUpdateInput:!0,minDate:new Date,locale:{format:"DD/MM/YYYY HH:mm"}},function(c,a){const b=$(this).attr("element").attr("id");$("#"+b+"-first").val(c.format("YYYY-MM-DD HH:mm:ss")),$("#"+b+"-second").val(a.format("YYYY-MM-DD HH:mm:ss"))})}function fireNotification(a){return $.notify({message:a.message,icon:"icon "+a.icon},{type:a.type,delay:1e3*a.delay})}function utcToLocal(a){return moment.utc(a).local()}function localTimestamp(a,b="DD/MM/YYYY HH:mm"){return utcToLocal(a).format(b)}function fromNowTimestamp(a){return utcToLocal(a).fromNow()}function toggleCheckboxes(a,b){const c=document.querySelectorAll("input."+b);for(const d of c)d.checked=a}function gatherFormInputs(a){return confirmAlert().then(b=>{if(b.value){fireNotification({message:"Saving data in progress...",icon:"fa fa-spinner fa-spin",type:"success",delay:0});const b=document.querySelectorAll("input.options-form:checked");for(const c of b)c.setAttribute("form",a.id);a.submit()}})}function displayErrors(a){const b=JSON.parse(document.getElementById(a).innerHTML.trim());for(const c of b)fireNotification({message:c,icon:"fa fa-exclamation-triangle",type:"danger",delay:5})}const DEFAULT_LAT=51.05604659107056,DEFAULT_LNG=1.2839645343922257;var maps=[];function initMaps(){const a=document.querySelectorAll(".map-area");for(const b of a)initMap(b)}function initMap(a){const b=a.dataset.basename,c=document.getElementById(b+"_lat").value,d=document.getElementById(b+"_lng").value,e={lat:""==c?DEFAULT_LAT:parseFloat(c),lng:""==d?DEFAULT_LNG:parseFloat(d)};maps[b]=new google.maps.Map(a,{center:e,zoom:9}),maps[b].marker=new google.maps.Marker({map:maps[b],position:""==c&&""==d?null:new google.maps.LatLng(parseFloat(c),parseFloat(d)),draggable:!0}),maps[b].addListener("click",a=>{pinOnMap(maps[b].marker,a.latLng.lat(),a.latLng.lng())}),maps[b].marker.addListener("position_changed",()=>{const a=maps[b].marker.getPosition();document.getElementById(b+"_lat").value=a.lat(),document.getElementById(b+"_lng").value=a.lng()})}function pinOnMap(a,b,c){a.setPosition(new google.maps.LatLng(parseFloat(b),parseFloat(c))),a.setAnimation(google.maps.Animation.DROP)}function coordinateChange(a){const b=document.getElementById(a+"_lat").value,c=document.getElementById(a+"_lng").value;return""==b||""==c?null:maps[a].marker.setPosition(new google.maps.LatLng(parseFloat(b),parseFloat(c)))}